{% extends "base/base.html" %}

{% block content %}
<h1>{{finca.nombre}}</h1>
<h1>{{coordenadas}}</h1>
<h1>Etapa del hongo en el lote1 segun el ultimo diagnostico: {{detalles_lote.1.etapa_hongo}}</h1>
<h1 id="selected">Seleccionado</h1>
<canvas id="myCanvas" style="border:1px solid #d3d3d3;">
Your browser does not support the HTML5 canvas tag.</canvas>

    
<script>
    var jsonContext = "{{coordenadas}}".replace(/(&quot\;)/g,"\"");
    var json = JSON.parse(jsonContext);       
    var c = document.getElementById("myCanvas");
    var ctx = c.getContext("2d");
    ctx.canvas.width = 500;
    ctx.canvas.height = 500;
    for (var i = 1; i <=4; i++) {
        ctx.fillRect(json["lot_"+i].x, json["lot_"+i].y, json["lot_"+i].w, json["lot_"+i].h);
        ctx.stroke();
    }
    var posx;
    var posy;
    c.addEventListener("click",handleClick);

    function getMousePos(c,evt){
    	var rect = c.getBoundingClientRect();
    	return {
    		x: evt.clientX,
        	y: evt.clientY
    	}
    }

    function handleClick(e){

    	var pos = getMousePos(c,e);
        var canva = c.getBoundingClientRect();
        posx = pos.x - canva.left;
        posy = pos.y - canva.top;

        for (var i = 1; i <=4; i++) {
            var x = json["lot_"+i].x;
            var y = json["lot_"+i].y;
            var w = json["lot_"+i].w;
            var h = json["lot_"+i].h;
            if(posx<=x+w&&posx>=x&&posy<=y+h&&posy>=y){
             document.getElementById("selected").innerHTML = "cuadro"+i;
                 var win = window.open("http://127.0.0.1:8000/admin/lote/lote/"+i+"/change/", '_blank');
                win.focus();
             
            }

        }
    }

</script> 
{% endblock content %}